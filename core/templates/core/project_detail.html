{% extends 'base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}{{ project.title }} - Projects - {{ site_settings.site_name }}{% endblock %}
{% block meta_description %}{{ project.short_description|default:project.description|truncatewords:30 }}{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap');
    :root{--navy:#0a0f2e;--navy-mid:#141b4d;--gold:#c9932a;--gold-light:#e8b84b;--gold-muted:#8a6520;--cream:#f8f4ef;--cream-dark:#ede8e0;--charcoal:#2c2c3e;--muted:#6b6b7f;}
    *{font-family:'DM Sans',sans-serif;}
    .font-display{font-family:'Playfair Display',Georgia,serif;}
    .font-mono{font-family:'DM Mono',monospace;}
    body{background:var(--cream);color:var(--charcoal);}

    .project-hero{background:var(--navy);position:relative;overflow:hidden;}
    .project-hero::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(201,147,42,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(201,147,42,.04) 1px,transparent 1px);background-size:60px 60px;}
    .blob{position:absolute;border-radius:50%;filter:blur(100px);pointer-events:none;}

    .breadcrumb-item{color:rgba(255,255,255,.45);font-size:.8rem;letter-spacing:.05em;}
    .breadcrumb-item a{color:rgba(255,255,255,.45);text-decoration:none;transition:color .2s;}
    .breadcrumb-item a:hover{color:var(--gold-light);}
    .breadcrumb-sep{color:rgba(255,255,255,.2);margin:0 .5rem;font-size:.7rem;}
    .breadcrumb-active{color:var(--gold-light);}

    .category-tag{display:inline-block;font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);border:1px solid rgba(201,147,42,.3);padding:.35rem .875rem;margin-bottom:1.25rem;}

    .meta-pill{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(4px);padding:.5rem 1rem;font-size:.8rem;color:rgba(255,255,255,.7);}
    .meta-pill i{color:var(--gold);font-size:.75rem;}

    .btn-white{display:inline-flex;align-items:center;gap:.625rem;padding:.875rem 1.75rem;background:#fff;color:var(--navy);font-size:.75rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;border:1px solid #fff;transition:all .25s ease;}
    .btn-white:hover{background:var(--cream);border-color:var(--cream);}
    .btn-ghost{display:inline-flex;align-items:center;gap:.625rem;padding:.875rem 1.75rem;background:transparent;color:#fff;font-size:.75rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;border:1px solid rgba(255,255,255,.35);transition:all .25s ease;}
    .btn-ghost:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.6);}

    .featured-image-wrap{background:#fff;border-bottom:3px solid var(--gold);}

    .content-section{padding:3.5rem 0;}
    .content-h2{font-family:'Playfair Display',serif;font-size:1.75rem;color:var(--navy);display:flex;align-items:center;gap:.875rem;margin-bottom:1.75rem;}
    .content-icon{width:44px;height:44px;background:var(--navy);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .content-icon i{color:var(--gold);font-size:.95rem;}

    .prose{color:var(--charcoal);line-height:1.8;font-size:.95rem;}
    .prose h2,.prose h3{font-family:'Playfair Display',serif;color:var(--navy);margin:2rem 0 .75rem;}
    .prose p{margin-bottom:1.25rem;}
    .prose blockquote{border-left:3px solid var(--gold);padding:.75rem 1.25rem;background:rgba(201,147,42,.04);margin:1.5rem 0;}

    .feature-item{display:flex;align-items:flex-start;gap:.875rem;padding:.875rem;background:#fff;border:1px solid var(--cream-dark);transition:all .2s ease;}
    .feature-item:hover{border-color:rgba(201,147,42,.25);background:rgba(201,147,42,.02);}
    .feature-check{width:28px;height:28px;background:var(--navy);display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
    .feature-check i{color:var(--gold);font-size:.65rem;}
    .feature-item span{font-size:.875rem;line-height:1.5;color:var(--charcoal);}

    .tech-tag{display:inline-block;font-family:'DM Mono',monospace;font-size:.75rem;color:var(--navy);background:var(--cream);border:1px solid var(--cream-dark);padding:.4rem .875rem;transition:all .2s ease;cursor:default;}
    .tech-tag:hover{border-color:var(--gold);background:#fff;}

    .gallery-item{overflow:hidden;cursor:pointer;position:relative;}
    .gallery-item::after{content:'\f00e';font-family:'Font Awesome 6 Free';font-weight:900;position:absolute;inset:0;background:rgba(10,15,46,.5);color:#fff;font-size:1.5rem;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease;}
    .gallery-item:hover::after{opacity:1;}
    .gallery-item img{width:100%;height:220px;object-fit:cover;display:block;transition:transform .5s ease;}
    .gallery-item:hover img{transform:scale(1.05);}

    .challenge-box,.solution-box{padding:1.75rem;border-left:3px solid;}
    .challenge-box{background:#fff8f0;border-color:#f97316;}
    .solution-box{background:#f0fff4;border-color:#22c55e;}

    /* Sidebar */
    .sidebar-card{background:#fff;border:1px solid rgba(201,147,42,.15);padding:2rem;position:relative;}
    .sidebar-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--gold-light));}
    .info-row{display:flex;align-items:center;gap:.875rem;padding:.875rem 0;border-bottom:1px solid var(--cream-dark);}
    .info-row:last-of-type{border-bottom:none;}
    .info-icon{width:36px;height:36px;background:var(--cream);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .info-icon i{color:var(--gold);font-size:.875rem;}
    .info-label{font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);font-family:'DM Mono',monospace;display:block;}
    .info-value{font-size:.9rem;font-weight:600;color:var(--navy);}

    .btn-primary-sm{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:var(--navy);color:var(--gold-light);font-size:.75rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;text-decoration:none;border:1px solid var(--navy);transition:all .25s;}
    .btn-primary-sm:hover{background:#1e2a6e;border-color:var(--gold);}
    .btn-dark-sm{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;background:var(--charcoal);color:#fff;font-size:.75rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;text-decoration:none;border:1px solid var(--charcoal);transition:all .25s;}
    .btn-dark-sm:hover{background:#1a1a2e;}

    .share-btn{flex:1;aspect-ratio:1;display:flex;align-items:center;justify-content:center;border:1px solid var(--cream-dark);color:var(--charcoal);text-decoration:none;font-size:.9rem;transition:all .2s;min-height:44px;}
    .share-btn:hover{border-color:var(--gold);color:var(--gold);}

    /* Related */
    .related-card{background:#fff;border:1px solid var(--cream-dark);transition:all .35s ease;display:block;text-decoration:none;color:inherit;}
    .related-card:hover{transform:translateY(-6px);border-color:rgba(201,147,42,.3);box-shadow:0 12px 40px rgba(10,15,46,.1);}
    .related-card img{width:100%;height:180px;object-fit:cover;display:block;transition:transform .5s ease;}
    .related-card:hover img{transform:scale(1.05);}

    .section-label{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:1rem;margin-bottom:3rem;}
    .section-label::before{content:'';width:3rem;height:1px;background:var(--cream-dark);}
    .section-label::after{content:'';flex:1;height:1px;background:var(--cream-dark);}

    /* CTA */
    .cta-section{background:var(--navy);position:relative;overflow:hidden;}
    .cta-section::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(201,147,42,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(201,147,42,.04) 1px,transparent 1px);background-size:60px 60px;}

    /* Lightbox */
    #lightbox{backdrop-filter:blur(12px);}

    @keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .7s ease forwards;}
    .d1{animation-delay:.1s;opacity:0;}.d2{animation-delay:.2s;opacity:0;}.d3{animation-delay:.3s;opacity:0;}
</style>
{% endblock %}

{% block content %}

<!-- Hero -->
<section class="project-hero pt-40 pb-20">
    <div class="blob w-[500px] h-[500px] opacity-10" style="background:radial-gradient(circle,#3b82f6,transparent);top:-100px;left:-100px;"></div>
    <div class="blob w-[400px] h-[400px] opacity-10" style="background:radial-gradient(circle,var(--gold),transparent);bottom:-80px;right:0;"></div>

    <div class="container mx-auto px-6 lg:px-8 max-w-5xl relative z-10">
        <!-- Breadcrumb -->
        <nav class="mb-10 fade-up" aria-label="Breadcrumb">
            <ol class="flex flex-wrap items-center gap-1">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                <li class="breadcrumb-sep">›</li>
                <li class="breadcrumb-item"><a href="{% url 'projects' %}">Projects</a></li>
                <li class="breadcrumb-sep">›</li>
                <li class="breadcrumb-active text-sm font-mono text-amber-300">{{ project.title|truncatewords:5 }}</li>
            </ol>
        </nav>

        <div class="max-w-3xl">
            <span class="category-tag fade-up d1">{{ project.category.name|default:'Project' }}</span>
            <h1 class="font-display text-5xl lg:text-6xl text-white leading-tight mb-6 fade-up d1">{{ project.title }}</h1>
            <p class="text-slate-300 text-lg leading-relaxed mb-10 fade-up d2">{{ project.short_description|default:project.description|truncatewords:30 }}</p>

            <!-- Meta pills -->
            <div class="flex flex-wrap gap-3 mb-10 fade-up d2">
                {% if project.completion_date %}<span class="meta-pill"><i class="fas fa-calendar-alt"></i>{{ project.completion_date|date:"M Y" }}</span>{% endif %}
                {% if project.client %}<span class="meta-pill"><i class="fas fa-building"></i>{{ project.client }}</span>{% endif %}
                <span class="meta-pill"><i class="fas fa-eye"></i>{{ project.views }} views</span>
                <span class="meta-pill"><i class="fas fa-heart"></i>{{ project.likes }} likes</span>
            </div>

            <!-- Actions -->
            <div class="flex flex-wrap gap-4 fade-up d3">
                {% if project.live_url %}<a href="{{ project.live_url }}" target="_blank" class="btn-white"><i class="fas fa-external-link-alt text-xs"></i>Live Demo</a>{% endif %}
                {% if project.github_url %}<a href="{{ project.github_url }}" target="_blank" class="btn-ghost"><i class="fab fa-github"></i>Source Code</a>{% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Featured Image -->
{% if project.featured_image %}
<div class="featured-image-wrap">
    <div class="container mx-auto px-6 lg:px-8 max-w-6xl">
        <img src="{{ project.featured_image.url }}" alt="{{ project.title }}" class="w-full max-h-[600px] object-cover" loading="eager">
    </div>
</div>
{% endif %}

<!-- Main Content -->
<section class="py-20" style="background:var(--cream)">
    <div class="container mx-auto px-6 lg:px-8 max-w-7xl">
        <div class="grid lg:grid-cols-3 gap-12">
            <!-- Content -->
            <div class="lg:col-span-2 space-y-16">

                <!-- Overview -->
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-align-left"></i></div>Project Overview</div>
                    <div class="prose">{{ project.description|safe }}</div>
                </div>

                <!-- Features -->
                {% if project.features %}
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-check"></i></div>Key Features</div>
                    <div class="grid md:grid-cols-2 gap-2">
                        {% for feature in project.feature_list %}
                        <div class="feature-item">
                            <div class="feature-check"><i class="fas fa-check"></i></div>
                            <span>{{ feature }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Technologies -->
                {% if project.technologies %}
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-code"></i></div>Technologies Used</div>
                    <div class="flex flex-wrap gap-2">
                        {% for tech in project.tech_list %}<span class="tech-tag">{{ tech }}</span>{% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Gallery -->
                {% if project.images.all %}
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-images"></i></div>Gallery</div>
                    <div class="grid md:grid-cols-2 gap-4">
                        {% for image in project.images.all %}
                        <div class="gallery-item" onclick="openLightbox({{ forloop.counter0 }})">
                            <img src="{{ image.image.url }}" alt="{{ image.caption }}" loading="lazy">
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Challenges & Solutions -->
                {% if project.challenges or project.solutions %}
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-lightbulb"></i></div>Challenges &amp; Solutions</div>
                    {% if project.challenges %}
                    <div class="challenge-box mb-4">
                        <h3 class="font-semibold mb-3 flex items-center gap-2 text-orange-700"><i class="fas fa-exclamation-triangle text-sm"></i>Challenges</h3>
                        <div class="prose text-sm">{{ project.challenges|safe }}</div>
                    </div>
                    {% endif %}
                    {% if project.solutions %}
                    <div class="solution-box">
                        <h3 class="font-semibold mb-3 flex items-center gap-2 text-green-700"><i class="fas fa-check-circle text-sm"></i>Solutions</h3>
                        <div class="prose text-sm">{{ project.solutions|safe }}</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Results -->
                {% if project.outcome %}
                <div data-aos="fade-up">
                    <div class="content-h2"><div class="content-icon"><i class="fas fa-chart-line"></i></div>Results &amp; Impact</div>
                    <div class="prose" style="background:#fff;border:1px solid var(--cream-dark);border-left:3px solid var(--gold);padding:1.75rem;">{{ project.outcome|safe }}</div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div data-aos="fade-left">
                <div class="sidebar-card sticky top-28">
                    <h3 class="font-display text-xl mb-6" style="color:var(--navy)">Project Info</h3>
                    {% if project.client %}
                    <div class="info-row"><div class="info-icon"><i class="fas fa-building"></i></div><div><span class="info-label">Client</span><span class="info-value">{{ project.client }}</span></div></div>
                    {% endif %}
                    {% if project.completion_date %}
                    <div class="info-row"><div class="info-icon"><i class="fas fa-calendar-check"></i></div><div><span class="info-label">Completed</span><span class="info-value">{{ project.completion_date|date:"F Y" }}</span></div></div>
                    {% endif %}
                    {% if project.duration %}
                    <div class="info-row"><div class="info-icon"><i class="fas fa-clock"></i></div><div><span class="info-label">Duration</span><span class="info-value">{{ project.duration }}</span></div></div>
                    {% endif %}
                    <div class="info-row mb-6"><div class="info-icon"><i class="fas fa-folder"></i></div><div><span class="info-label">Category</span><span class="info-value">{{ project.category.name }}</span></div></div>

                    <div class="flex flex-col gap-2 mb-6">
                        {% if project.live_url %}<a href="{{ project.live_url }}" target="_blank" class="btn-primary-sm"><i class="fas fa-external-link-alt text-xs"></i>Visit Website</a>{% endif %}
                        {% if project.github_url %}<a href="{{ project.github_url }}" target="_blank" class="btn-dark-sm"><i class="fab fa-github"></i>View Code</a>{% endif %}
                    </div>

                    <div class="pt-5" style="border-top:1px solid var(--cream-dark)">
                        <p class="font-mono text-xs tracking-widest uppercase mb-3" style="color:var(--muted)">Share</p>
                        <div class="flex gap-2">
                            <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ project.title|urlencode }}" target="_blank" class="share-btn"><i class="fab fa-twitter"></i></a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" target="_blank" class="share-btn"><i class="fab fa-linkedin-in"></i></a>
                            <button onclick="copyLink()" class="share-btn"><i class="fas fa-link"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Projects -->
{% if related_projects %}
<section class="py-20 bg-white">
    <div class="container mx-auto px-6 lg:px-8 max-w-6xl">
        <div class="section-label">Related Projects</div>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for related in related_projects %}
            <a href="{{ related.get_absolute_url }}" class="related-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|mul:80 }}">
                {% if related.featured_image or related.thumbnail %}
                <div class="overflow-hidden"><img src="{% if related.thumbnail %}{{ related.thumbnail.url }}{% else %}{{ related.featured_image.url }}{% endif %}" alt="{{ related.title }}"></div>
                {% endif %}
                <div class="p-6">
                    <h3 class="font-semibold mb-2 leading-snug" style="color:var(--navy)">{{ related.title }}</h3>
                    <p class="text-sm mb-3 line-clamp-2" style="color:var(--muted)">{{ related.short_description }}</p>
                    <span class="link-gold text-xs font-mono tracking-widest uppercase" style="color:var(--gold-muted)">View Project →</span>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- CTA -->
<section class="cta-section py-28">
    <div class="blob w-96 h-96 opacity-10" style="background:radial-gradient(circle,var(--gold),transparent);top:50%;left:-100px;transform:translateY(-50%)"></div>
    <div class="container mx-auto px-6 lg:px-8 max-w-3xl text-center relative z-10" data-aos="fade-up">
        <span class="font-mono text-xs tracking-widest text-amber-400 uppercase">Let's Work Together</span>
        <h2 class="font-display text-5xl text-white mt-4 mb-5 leading-tight">Like What<br><em class="text-amber-300">You See?</em></h2>
        <p class="text-slate-400 text-lg mb-10 leading-relaxed">Let's collaborate on your next project and create something extraordinary together.</p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="{% url 'contact' %}" class="btn-white"><i class="fas fa-envelope text-xs"></i>Start a Project</a>
            <a href="{% url 'projects' %}" class="btn-ghost"><i class="fas fa-folder text-xs"></i>View All Projects</a>
        </div>
    </div>
</section>

<!-- Lightbox -->
<div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4" onclick="closeLightbox()">
    <button class="absolute top-6 right-6 text-white text-3xl hover:text-amber-300 transition-colors" onclick="closeLightbox()"><i class="fas fa-times"></i></button>
    <button class="absolute left-6 text-white text-2xl hover:text-amber-300 transition-colors" onclick="prevImage();event.stopPropagation()"><i class="fas fa-chevron-left"></i></button>
    <button class="absolute right-16 text-white text-2xl hover:text-amber-300 transition-colors" onclick="nextImage();event.stopPropagation()"><i class="fas fa-chevron-right"></i></button>
    <img id="lightbox-image" src="" alt="" class="max-w-full max-h-full object-contain" onclick="event.stopPropagation()">
</div>

{% endblock %}

{% block extra_js %}
<script>
AOS.init({duration:900,once:true,offset:80});
const images=[{% for image in project.images.all %}'{{ image.image.url }}',{% endfor %}];
let ci=0;
function openLightbox(i){ci=i;const l=document.getElementById('lightbox');l.classList.remove('hidden');l.classList.add('flex');document.getElementById('lightbox-image').src=images[ci];document.body.style.overflow='hidden';}
function closeLightbox(){const l=document.getElementById('lightbox');l.classList.add('hidden');l.classList.remove('flex');document.body.style.overflow='';}
function nextImage(){ci=(ci+1)%images.length;document.getElementById('lightbox-image').src=images[ci];}
function prevImage(){ci=(ci-1+images.length)%images.length;document.getElementById('lightbox-image').src=images[ci];}
document.addEventListener('keydown',e=>{const l=document.getElementById('lightbox');if(!l.classList.contains('hidden')){if(e.key==='Escape')closeLightbox();if(e.key==='ArrowRight')nextImage();if(e.key==='ArrowLeft')prevImage();}});
function copyLink(){navigator.clipboard.writeText(window.location.href).then(()=>{const t=document.createElement('div');t.className='fixed bottom-6 right-6 text-sm px-5 py-3 z-50';t.style.cssText='background:var(--navy);color:var(--gold-light);border:1px solid var(--gold);font-family:DM Mono,monospace;letter-spacing:.05em;';t.innerHTML='<i class="fas fa-check mr-2"></i>Link copied';document.body.appendChild(t);setTimeout(()=>t.remove(),2500);});}
</script>
{% endblock %}