{% extends 'base.html' %}
{% load static %}

{% block title %}Contact — {{ site_settings.site_name }}{% endblock %}
{% block meta_description %}Get in touch with {{ site_settings.site_name }}. Let's discuss your project.{% endblock %}

{% block extra_css %}
<style>
    .contact-hero {
        background: #0a0f2e; position: relative; overflow: hidden;
    }
    .contact-hero-grid {
        position: absolute; inset: 0;
        background-image: linear-gradient(rgba(201,147,42,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(201,147,42,0.04) 1px, transparent 1px);
        background-size: 80px 80px;
    }
    .breadcrumb { display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; }
    .breadcrumb a { color: rgba(255,255,255,0.4); transition: color 0.2s; }
    .breadcrumb a:hover { color: #fbbf24; }
    .breadcrumb .sep { color: rgba(255,255,255,0.2); }
    .breadcrumb .current { color: #fbbf24; }

    /* Form */
    .form-field { position: relative; }
    .form-input {
        width: 100%;
        padding: 0.875rem 1rem;
        background: rgba(0,0,0,0.02);
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 4px;
        font-size: 0.9rem;
        font-family: 'DM Sans', sans-serif;
        color: #0f172a;
        transition: all 0.25s ease;
        outline: none;
    }
    .dark .form-input {
        background: rgba(255,255,255,0.03);
        border-color: rgba(255,255,255,0.1);
        color: #f1f5f9;
    }
    .form-input::placeholder { color: #94a3b8; }
    .form-input:focus { border-color: #c9932a; box-shadow: 0 0 0 3px rgba(201,147,42,0.08); }
    .form-label {
        display: block;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #64748b;
        margin-bottom: 0.5rem;
    }
    .dark .form-label { color: #94a3b8; }
    textarea.form-input { resize: vertical; min-height: 140px; }
    select.form-input { appearance: none; cursor: pointer; }

    /* Contact info card */
    .ci-card {
        display: flex; align-items: center; gap: 1rem;
        padding: 1.25rem 1.5rem;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.07);
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    .ci-card:hover { border-color: rgba(201,147,42,0.3); background: rgba(201,147,42,0.04); }
    .ci-icon { width: 2.5rem; height: 2.5rem; background: linear-gradient(135deg, #c9932a, #fbbf24); display: flex; align-items: center; justify-content: center; color: #0a0f2e; border-radius: 4px; flex-shrink: 0; font-size: 0.875rem; }

    /* FAQ */
    .faq-item { border-bottom: 1px solid rgba(0,0,0,0.06); }
    .dark .faq-item { border-color: rgba(255,255,255,0.05); }
    .faq-btn { width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 1.25rem 0; text-align: left; cursor: pointer; }
    .faq-btn:focus-visible { outline: 2px solid #c9932a; outline-offset: 2px; }
    .faq-answer { overflow: hidden; max-height: 0; transition: max-height 0.4s ease; }
    .faq-answer.open { max-height: 400px; }
    .faq-answer-inner { padding-bottom: 1.25rem; }
    .faq-icon { width: 1.5rem; height: 1.5rem; border: 1px solid rgba(201,147,42,0.4); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.3s ease; }
    .faq-icon i { font-size: 0.6rem; color: #c9932a; transition: transform 0.3s ease; }
    .faq-btn[aria-expanded="true"] .faq-icon { background: #c9932a; border-color: #c9932a; }
    .faq-btn[aria-expanded="true"] .faq-icon i { color: #0a0f2e; transform: rotate(45deg); }

    /* Submit button states */
    #submit-btn { transition: all 0.3s ease; }
    #submit-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none !important; }

    /* Char counter */
    .char-count { font-size: 0.7rem; font-family: 'DM Mono', monospace; color: #94a3b8; text-align: right; margin-top: 0.375rem; }
    .char-count.warning { color: #f59e0b; }
    .char-count.danger { color: #ef4444; }
</style>
{% endblock %}

{% block content %}

<!-- ==================== HERO ==================== -->
<section class="contact-hero pt-28 pb-20">
    <div class="contact-hero-grid"></div>
    <div class="absolute top-16 left-0 right-0 h-px" style="background: linear-gradient(90deg, transparent 5%, rgba(201,147,42,0.3) 50%, transparent 95%);"></div>
    
    <div class="relative z-10 max-w-7xl mx-auto px-6 lg:px-8">
        <nav class="breadcrumb mb-12" data-aos="fade-down">
            <a href="{% url 'home' %}">Home</a>
            <span class="sep">/</span>
            <span class="current">Contact</span>
        </nav>
        
        <div class="max-w-3xl">
            <div style="display:inline-flex;align-items:center;gap:.5rem;padding:.4rem 1rem;border:1px solid rgba(201,147,42,0.3);background:rgba(201,147,42,0.06);border-radius:100px;font-size:.7rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:#fbbf24;" class="mb-8" data-aos="fade-up">
                <i class="fas fa-comment-dots"></i> Let's Connect
            </div>
            <h1 class="font-display text-5xl lg:text-7xl font-bold text-white mb-6 leading-tight" data-aos="fade-up" data-aos-delay="80">
                Get in <span class="italic" style="color:transparent;-webkit-text-stroke:1px rgba(201,147,42,0.6);">Touch</span>
            </h1>
            <p class="text-slate-400 text-xl leading-relaxed" data-aos="fade-up" data-aos-delay="160">
                Have a project in mind? Let's discuss how we can create something remarkable together.
            </p>
        </div>
    </div>
</section>

<!-- ==================== MAIN CONTENT ==================== -->
<section class="py-28 lg:py-36 bg-white dark:bg-navy-950">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
        <div class="grid lg:grid-cols-5 gap-16">
            
            <!-- ===== FORM (3 cols) ===== -->
            <div class="lg:col-span-3" data-aos="fade-right">
                <div class="mb-8">
                    <div class="section-label mb-4">Project Inquiry</div>
                    <h2 class="font-display text-3xl font-bold text-slate-900 dark:text-white">Send a Message</h2>
                    <p class="text-slate-500 dark:text-slate-400 text-sm mt-2">I typically respond within 24 hours on business days.</p>
                </div>
                
                <form id="contact-form" method="post" class="space-y-5" novalidate>
                    {% csrf_token %}
                    
                    <div class="grid sm:grid-cols-2 gap-5">
                        <div>
                            <label for="id_name" class="form-label">Full Name <span class="text-gold-500">*</span></label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none text-slate-400"><i class="fas fa-user text-xs"></i></div>
                                <input type="text" id="id_name" name="name" required placeholder="John Doe" class="form-input pl-9">
                            </div>
                        </div>
                        <div>
                            <label for="id_email" class="form-label">Email Address <span class="text-gold-500">*</span></label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none text-slate-400"><i class="fas fa-envelope text-xs"></i></div>
                                <input type="email" id="id_email" name="email" required placeholder="you@example.com" class="form-input pl-9">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid sm:grid-cols-2 gap-5">
                        <div>
                            <label for="id_phone" class="form-label">Phone <span class="text-slate-400 normal-case" style="letter-spacing:0">(optional)</span></label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none text-slate-400"><i class="fas fa-phone text-xs"></i></div>
                                <input type="tel" id="id_phone" name="phone" placeholder="+1 555 000 0000" class="form-input pl-9">
                            </div>
                        </div>
                        <div>
                            <label for="id_subject" class="form-label">Subject <span class="text-gold-500">*</span></label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none text-slate-400"><i class="fas fa-tag text-xs"></i></div>
                                <input type="text" id="id_subject" name="subject" required placeholder="Project Inquiry" class="form-input pl-9">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid sm:grid-cols-2 gap-5">
                        <div>
                            <label for="id_budget" class="form-label">Budget Range</label>
                            <div class="relative">
                                <select id="id_budget" name="budget" class="form-input pr-8">
                                    <option value="">Select range…</option>
                                    <option value="under_5k">Under $5,000</option>
                                    <option value="5k_10k">$5,000 — $10,000</option>
                                    <option value="10k_25k">$10,000 — $25,000</option>
                                    <option value="25k_50k">$25,000 — $50,000</option>
                                    <option value="over_50k">Over $50,000</option>
                                </select>
                                <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-chevron-down text-xs"></i></div>
                            </div>
                        </div>
                        <div>
                            <label for="id_timeline" class="form-label">Timeline</label>
                            <div class="relative">
                                <select id="id_timeline" name="timeline" class="form-input pr-8">
                                    <option value="">Select timeline…</option>
                                    <option value="asap">ASAP</option>
                                    <option value="1_2_weeks">1–2 weeks</option>
                                    <option value="1_3_months">1–3 months</option>
                                    <option value="3_6_months">3–6 months</option>
                                    <option value="flexible">Flexible</option>
                                </select>
                                <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-chevron-down text-xs"></i></div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="id_message" class="form-label">Message <span class="text-gold-500">*</span></label>
                        <textarea id="id_message" name="message" required maxlength="1000" placeholder="Tell me about your project, goals, and requirements…" class="form-input" rows="6"></textarea>
                        <div id="char-count" class="char-count">0 / 1000</div>
                    </div>
                    
                    <!-- Honeypot -->
                    <input type="text" name="website" class="hidden" tabindex="-1" autocomplete="off">
                    
                    <button type="submit" id="submit-btn" class="group w-full inline-flex items-center justify-center gap-3 px-8 py-4 bg-navy-900 dark:bg-gold-500 text-white dark:text-navy-900 font-bold rounded-sm transition-all hover:bg-gold-500 hover:text-navy-900 dark:hover:bg-gold-400 hover:shadow-gold">
                        <span id="submit-text" class="flex items-center gap-3">
                            <i class="fas fa-paper-plane text-sm"></i>
                            Send Message
                        </span>
                        <span id="submit-loading" class="hidden items-center gap-3">
                            <i class="fas fa-spinner fa-spin text-sm"></i>
                            Sending…
                        </span>
                    </button>
                    
                    <p class="text-xs text-slate-400 text-center"><i class="fas fa-lock mr-1.5"></i>Your information is secure and will never be shared.</p>
                </form>
            </div>
            
            <!-- ===== SIDEBAR (2 cols) ===== -->
            <div class="lg:col-span-2 space-y-8" data-aos="fade-left">
                
                <!-- Contact Info -->
                <div>
                    <div class="section-label mb-5">Contact</div>
                    <div class="space-y-3">
                        <div class="ci-card">
                            <div class="ci-icon"><i class="fas fa-envelope"></i></div>
                            <div class="min-w-0">
                                <div class="text-xs text-slate-500 uppercase tracking-widest mb-0.5">Email</div>
                                <a href="mailto:{{ site_settings.email }}" class="text-sm font-semibold text-slate-900 dark:text-white hover:text-gold-500 dark:hover:text-gold-400 transition-colors break-all">{{ site_settings.email }}</a>
                            </div>
                        </div>
                        {% if site_settings.phone %}
                        <div class="ci-card">
                            <div class="ci-icon"><i class="fas fa-phone"></i></div>
                            <div>
                                <div class="text-xs text-slate-500 uppercase tracking-widest mb-0.5">Phone</div>
                                <a href="tel:{{ site_settings.phone }}" class="text-sm font-semibold text-slate-900 dark:text-white hover:text-gold-500 dark:hover:text-gold-400 transition-colors">{{ site_settings.phone }}</a>
                            </div>
                        </div>
                        {% endif %}
                        <div class="ci-card">
                            <div class="ci-icon"><i class="fas fa-location-dot"></i></div>
                            <div>
                                <div class="text-xs text-slate-500 uppercase tracking-widest mb-0.5">Location</div>
                                <span class="text-sm font-semibold text-slate-900 dark:text-white">{{ site_settings.location }}</span>
                                <div class="text-xs text-slate-400 mt-0.5">Available remotely worldwide</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Availability -->
                <div class="p-6 bg-navy-900 rounded-sm border border-white/5 relative overflow-hidden">
                    <div class="absolute top-0 left-0 right-0 h-px" style="background: linear-gradient(90deg, transparent, rgba(201,147,42,0.5) 50%, transparent);"></div>
                    <div class="flex items-start gap-3 mb-4">
                        {% if site_settings.available_for_work %}
                        <div class="flex items-center gap-2">
                            <span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span></span>
                            <span class="text-sm font-semibold text-emerald-400">Available for Projects</span>
                        </div>
                        {% else %}
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 bg-amber-400 rounded-full"></span>
                            <span class="text-sm font-semibold text-amber-400">Limited Availability</span>
                        </div>
                        {% endif %}
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed">
                        {% if site_settings.available_for_work %}
                        Accepting new projects and collaborations. Let's discuss your requirements.
                        {% else %}
                        Currently at capacity, but reach out for future projects or the waitlist.
                        {% endif %}
                    </p>
                    <div class="mt-4 pt-4 border-t border-white/5">
                        <div class="text-xs text-slate-500 flex items-center gap-2"><i class="fas fa-clock text-gold-500"></i> Response within 24 hours</div>
                    </div>
                </div>
                
                <!-- Map -->
                <div class="rounded-sm overflow-hidden border border-slate-100 dark:border-white/5">
                    <div class="h-52">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d255282.35823184754!2d36.70730158674246!3d-1.3031976327445654!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x182f1172d84d49a7%3A0xf7cf0254b297924c!2sNairobi%2C%20Kenya!5e0!3m2!1sen!2sus!4v1707758400000!5m2!1sen!2sus" width="100%" height="100%" style="border:0; filter:grayscale(0.8);" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
                
                <!-- Social -->
                <div>
                    <div class="text-xs font-semibold uppercase tracking-widest text-slate-500 mb-4">Find Me Online</div>
                    <div class="flex gap-3">
                        {% if site_settings.github_url %}
                        <a href="{{ site_settings.github_url }}" target="_blank" class="flex-1 py-3 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-sm flex items-center justify-center text-slate-500 dark:text-slate-400 hover:border-gold-500/40 hover:text-gold-600 dark:hover:text-gold-400 transition-all text-sm" title="GitHub">
                            <i class="fab fa-github mr-2"></i> GitHub
                        </a>
                        {% endif %}
                        {% if site_settings.linkedin_url %}
                        <a href="{{ site_settings.linkedin_url }}" target="_blank" class="flex-1 py-3 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-sm flex items-center justify-center text-slate-500 dark:text-slate-400 hover:border-gold-500/40 hover:text-gold-600 dark:hover:text-gold-400 transition-all text-sm" title="LinkedIn">
                            <i class="fab fa-linkedin-in mr-2"></i> LinkedIn
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== FAQ ==================== -->
{% if faqs %}
<section class="py-28 bg-slate-50 dark:bg-navy-900/40">
    <div class="max-w-3xl mx-auto px-6 lg:px-8">
        <div class="text-center mb-14" data-aos="fade-up">
            <div class="section-label mb-5">FAQ</div>
            <h2 class="font-display text-4xl font-bold text-slate-900 dark:text-white">Frequently Asked <span class="text-gold">Questions</span></h2>
        </div>
        
        <div data-aos="fade-up">
            {% for faq in faqs %}
            <div class="faq-item">
                <button class="faq-btn" aria-expanded="false" onclick="toggleFaq(this)">
                    <span class="font-semibold text-slate-900 dark:text-white text-sm pr-8">{{ faq.question }}</span>
                    <div class="faq-icon"><i class="fas fa-plus"></i></div>
                </button>
                <div class="faq-answer">
                    <div class="faq-answer-inner text-sm text-slate-600 dark:text-slate-400 leading-relaxed">{{ faq.answer }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// Char counter
const msgField = document.getElementById('id_message');
const charCount = document.getElementById('char-count');
msgField?.addEventListener('input', function() {
    const n = this.value.length;
    charCount.textContent = n + ' / 1000';
    charCount.classList.toggle('warning', n > 800 && n <= 900);
    charCount.classList.toggle('danger', n > 900);
});

// Form submit
const form = document.getElementById('contact-form');
const submitBtn = document.getElementById('submit-btn');
const submitText = document.getElementById('submit-text');
const submitLoading = document.getElementById('submit-loading');

form?.addEventListener('submit', async function(e) {
    e.preventDefault();
    if (msgField.value.trim().length < 10) {
        msgField.focus();
        msgField.style.borderColor = '#ef4444';
        setTimeout(() => msgField.style.borderColor = '', 2000);
        return;
    }
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    submitLoading.classList.remove('hidden');
    submitLoading.style.display = 'flex';
    
    const fd = new FormData(form);
    try {
        const res = await fetch('{% url "contact" %}', {
            method: 'POST', body: fd,
            headers: { 'X-CSRFToken': fd.get('csrfmiddlewaretoken') }
        });
        if (res.ok) {
            form.reset();
            charCount.textContent = '0 / 1000';
            showNotification('Message sent! I\'ll respond within 24 hours.', 'success');
        } else { throw new Error(); }
    } catch {
        showNotification('Something went wrong. Please email me directly.', 'error');
    } finally {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitLoading.classList.add('hidden');
        submitLoading.style.display = '';
    }
});

function showNotification(msg, type) {
    const el = document.createElement('div');
    const color = type === 'success' ? 'bg-emerald-600' : 'bg-red-600';
    el.className = `fixed top-20 left-1/2 -translate-x-1/2 z-50 px-6 py-3.5 ${color} text-white text-sm font-semibold rounded-sm shadow-xl flex items-center gap-2`;
    el.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'times'}"></i> ${msg}`;
    document.body.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; el.style.transition = 'opacity 0.4s'; setTimeout(() => el.remove(), 400); }, 5000);
}

// FAQ toggle
function toggleFaq(btn) {
    const isOpen = btn.getAttribute('aria-expanded') === 'true';
    // Close all
    document.querySelectorAll('.faq-btn[aria-expanded="true"]').forEach(b => {
        b.setAttribute('aria-expanded', 'false');
        b.nextElementSibling.classList.remove('open');
    });
    // Open this
    if (!isOpen) {
        btn.setAttribute('aria-expanded', 'true');
        btn.nextElementSibling.classList.add('open');
    }
}
</script>
{% endblock %}