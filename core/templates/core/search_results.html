{% extends 'base.html' %}
{% load static %}

{% block title %}{% if query %}Search: "{{ query }}"{% else %}Search{% endif %} - {{ site_settings.site_name }}{% endblock %}
{% block meta_description %}Search results for {{ query }} - Find projects, blog posts, and services.{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap');
    :root{--navy:#0a0f2e;--navy-mid:#141b4d;--gold:#c9932a;--gold-light:#e8b84b;--gold-muted:#8a6520;--cream:#f8f4ef;--cream-dark:#ede8e0;--charcoal:#2c2c3e;--muted:#6b6b7f;}
    *{font-family:'DM Sans',sans-serif;}
    .font-display{font-family:'Playfair Display',Georgia,serif;}
    .font-mono{font-family:'DM Mono',monospace;}
    body{background:var(--cream);color:var(--charcoal);}

    .search-hero{background:var(--navy);position:relative;overflow:hidden;}
    .search-hero::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(201,147,42,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(201,147,42,.04) 1px,transparent 1px);background-size:60px 60px;}
    .blob{position:absolute;border-radius:50%;filter:blur(100px);pointer-events:none;}

    .search-box{background:#fff;border:none;display:flex;align-items:stretch;box-shadow:0 4px 40px rgba(10,15,46,.25);}
    .search-box input{flex:1;padding:1.25rem 1.5rem;font-size:1.1rem;color:var(--charcoal);border:none;outline:none;background:transparent;}
    .search-box input::placeholder{color:rgba(44,44,62,.35);}
    .search-box button{padding:0 2rem;background:var(--navy);color:var(--gold-light);font-family:'DM Mono',monospace;font-size:.75rem;letter-spacing:.1em;text-transform:uppercase;border:none;cursor:pointer;transition:background .2s;white-space:nowrap;display:flex;align-items:center;gap:.625rem;}
    .search-box button:hover{background:#1e2a6e;}

    .quick-tag{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;padding:.4rem 1rem;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.6);text-decoration:none;transition:all .2s ease;}
    .quick-tag:hover{background:rgba(255,255,255,.15);border-color:rgba(201,147,42,.4);color:var(--gold-light);}

    /* Filter tabs */
    .tab-btn{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;padding:.625rem 1.25rem;background:#fff;border:1px solid var(--cream-dark);color:var(--muted);cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.5rem;}
    .tab-btn:hover{border-color:var(--gold);color:var(--navy);}
    .tab-btn.active{background:var(--navy);border-color:var(--navy);color:var(--gold-light);}
    .tab-count{font-size:.6rem;background:rgba(255,255,255,.15);padding:.15rem .5rem;border-radius:999px;}
    .tab-btn:not(.active) .tab-count{background:var(--cream-dark);color:var(--muted);}

    /* Section header */
    .result-section-header{display:flex;align-items:center;gap:.875rem;margin-bottom:2rem;}
    .section-bar{width:4px;height:2.5rem;background:linear-gradient(to bottom,var(--gold),var(--gold-light));}
    .section-title{font-family:'Playfair Display',serif;font-size:1.625rem;color:var(--navy);}
    .section-count{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.1em;padding:.35rem .875rem;background:var(--cream);border:1px solid var(--cream-dark);color:var(--muted);}

    /* Project result card */
    .proj-result{background:#fff;border:1px solid var(--cream-dark);display:flex;flex-direction:column;transition:all .3s ease;text-decoration:none;color:inherit;}
    .proj-result:hover{transform:translateY(-5px);border-color:rgba(201,147,42,.25);box-shadow:0 12px 40px rgba(10,15,46,.08);}
    .proj-result-img{height:180px;overflow:hidden;background:var(--navy-mid);position:relative;}
    .proj-result-img img{width:100%;height:100%;object-fit:cover;transition:transform .5s ease;}
    .proj-result:hover .proj-result-img img{transform:scale(1.05);}
    .proj-result-img-placeholder{height:100%;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,.1);font-size:2.5rem;}
    .proj-result-body{padding:1.25rem;}

    /* Blog result card */
    .post-result{background:#fff;border:1px solid var(--cream-dark);display:flex;flex-direction:column md:flex-row;transition:all .3s ease;text-decoration:none;color:inherit;overflow:hidden;}
    .post-result:hover{transform:translateY(-3px);border-color:rgba(201,147,42,.25);box-shadow:0 10px 35px rgba(10,15,46,.07);}
    .post-result-img{min-width:280px;height:200px;overflow:hidden;background:var(--navy-mid);position:relative;flex-shrink:0;}
    .post-result-img img{width:100%;height:100%;object-fit:cover;transition:transform .5s ease;}
    .post-result:hover .post-result-img img{transform:scale(1.04);}
    .post-result-body{padding:1.75rem;flex:1;}

    /* Service result card */
    .service-result{background:#fff;border:1px solid var(--cream-dark);padding:2rem;transition:all .3s ease;position:relative;overflow:hidden;}
    .service-result::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(to bottom,var(--gold),var(--gold-light));transform:scaleY(0);transform-origin:top;transition:transform .3s ease;}
    .service-result:hover{transform:translateY(-4px);border-color:rgba(201,147,42,.2);box-shadow:0 12px 40px rgba(10,15,46,.08);}
    .service-result:hover::before{transform:scaleY(1);}
    .service-icon{width:48px;height:48px;background:var(--navy);display:flex;align-items:center;justify-content:center;margin-bottom:1.25rem;flex-shrink:0;}
    .service-icon i{color:var(--gold);font-size:1.1rem;}

    /* Tags */
    .tag-pill{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.06em;padding:.3rem .75rem;background:var(--cream);border:1px solid var(--cream-dark);color:var(--charcoal);text-decoration:none;transition:all .2s;}
    .tag-pill:hover{border-color:var(--gold);color:var(--navy);}

    /* Search highlight */
    .search-hl{background:rgba(201,147,42,.2);color:var(--gold-muted);font-weight:600;padding:0 2px;}

    /* No results */
    .tips-box{background:#fff;border:1px solid var(--cream-dark);padding:2rem;}
    .tip-item{display:flex;align-items:flex-start;gap:.75rem;padding:.625rem 0;border-bottom:1px solid var(--cream-dark);font-size:.875rem;}
    .tip-item:last-child{border-bottom:none;}
    .tip-item i{color:var(--gold);margin-top:3px;font-size:.7rem;}

    .browse-card{background:#fff;border:1px solid var(--cream-dark);padding:2.5rem;text-align:center;text-decoration:none;color:inherit;display:block;transition:all .3s ease;}
    .browse-card:hover{transform:translateY(-6px);border-color:rgba(201,147,42,.3);box-shadow:0 12px 40px rgba(10,15,46,.08);}
    .browse-icon{width:64px;height:64px;display:flex;align-items:center;justify-content:center;margin:0 auto 1.25rem;background:var(--navy);}
    .browse-icon i{color:var(--gold);font-size:1.5rem;}

    .section-label{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:1rem;margin-bottom:3rem;}
    .section-label::before{content:'';width:3rem;height:1px;background:var(--cream-dark);}
    .section-label::after{content:'';flex:1;height:1px;background:var(--cream-dark);}

    .meta-line{font-family:'DM Mono',monospace;font-size:.7rem;color:var(--muted);display:flex;flex-wrap:wrap;gap:1rem;}
    .meta-line i{margin-right:.25rem;}

    .link-arrow{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold-muted);display:inline-flex;align-items:center;gap:.375rem;text-decoration:none;border-bottom:1px solid transparent;transition:all .2s;}
    .link-arrow:hover{color:var(--gold);border-bottom-color:var(--gold);}

    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .result-card{animation:fadeUp .5s ease forwards;opacity:0;}
    .result-card:nth-child(1){animation-delay:.05s}.result-card:nth-child(2){animation-delay:.1s}.result-card:nth-child(3){animation-delay:.15s}.result-card:nth-child(4){animation-delay:.2s}.result-card:nth-child(n+5){animation-delay:.25s}
    .d1{animation-delay:.1s;opacity:0;}.d2{animation-delay:.2s;opacity:0;}.d3{animation-delay:.3s;opacity:0;}
    .fade-up{animation:fadeUp .7s ease forwards;}
</style>
{% endblock %}

{% block content %}

<!-- Hero -->
<section class="search-hero pt-40 pb-20">
    <div class="blob w-[500px] h-[500px] opacity-10" style="background:radial-gradient(circle,#4f46e5,transparent);top:-150px;left:-100px;"></div>
    <div class="blob w-[400px] h-[400px] opacity-10" style="background:radial-gradient(circle,var(--gold),transparent);bottom:-100px;right:0;"></div>
    <div class="container mx-auto px-6 lg:px-8 max-w-4xl text-center relative z-10">
        <span class="font-mono text-xs tracking-widest text-amber-400 uppercase fade-up">Search</span>
        {% if query %}
        <h1 class="font-display text-5xl lg:text-6xl text-white mt-3 mb-4 leading-tight fade-up d1">Results for<br><em class="text-amber-300">"{{ query }}"</em></h1>
        {% if total_results > 0 %}
        <p class="text-slate-400 mb-8 fade-up d2"><span class="text-amber-300 font-semibold">{{ total_results }}</span> result{{ total_results|pluralize }} found across projects, blog posts, and services</p>
        {% else %}
        <p class="text-slate-400 mb-8 fade-up d2">No results found. Try different keywords or browse below.</p>
        {% endif %}
        {% else %}
        <h1 class="font-display text-5xl lg:text-6xl text-white mt-3 mb-4 leading-tight fade-up d1">Search<br><em class="text-amber-300">Everything</em></h1>
        <p class="text-slate-400 mb-8 fade-up d2">Search across all projects, blog posts, and services</p>
        {% endif %}

        <!-- Search form -->
        <div class="fade-up d2">
            <form method="get" action="{% url 'search' %}">
                <div class="search-box">
                    <input type="text" name="q" value="{{ query }}" placeholder="Search projects, blog posts, services…" autofocus>
                    <button type="submit"><i class="fas fa-search"></i><span class="hidden sm:inline">Search</span></button>
                </div>
            </form>
        </div>

        {% if not query %}
        <div class="flex flex-wrap justify-center gap-2 mt-6 fade-up d3">
            <span class="text-xs text-slate-500 self-center font-mono tracking-widest uppercase">Try:</span>
            <a href="?q=web+development" class="quick-tag">Web Development</a>
            <a href="?q=design" class="quick-tag">Design</a>
            <a href="?q=react" class="quick-tag">React</a>
            <a href="?q=python" class="quick-tag">Python</a>
            <a href="?q=django" class="quick-tag">Django</a>
        </div>
        {% endif %}
    </div>
</section>

{% if query %}
<section class="py-20" style="background:var(--cream)">
    <div class="container mx-auto px-6 lg:px-8 max-w-6xl">
        {% if total_results > 0 %}
        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-12" data-aos="fade-up">
            <button class="tab-btn active" data-filter="all"><i class="fas fa-globe text-xs"></i>All<span class="tab-count">{{ total_results }}</span></button>
            {% if projects %}<button class="tab-btn" data-filter="projects"><i class="fas fa-folder text-xs"></i>Projects<span class="tab-count">{{ projects|length }}</span></button>{% endif %}
            {% if posts %}<button class="tab-btn" data-filter="posts"><i class="fas fa-newspaper text-xs"></i>Blog<span class="tab-count">{{ posts|length }}</span></button>{% endif %}
            {% if services %}<button class="tab-btn" data-filter="services"><i class="fas fa-briefcase text-xs"></i>Services<span class="tab-count">{{ services|length }}</span></button>{% endif %}
        </div>

        <!-- Projects -->
        {% if projects %}
        <div class="result-group mb-16" data-category="projects" data-aos="fade-up">
            <div class="result-section-header">
                <div class="section-bar"></div>
                <h2 class="section-title">Projects</h2>
                <span class="section-count">{{ projects|length }}</span>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
                {% for project in projects %}
                <a href="{{ project.get_absolute_url }}" class="proj-result result-card">
                    <div class="proj-result-img">
                        {% if project.thumbnail or project.featured_image %}<img src="{{ project.thumbnail|default:project.featured_image }}" alt="{{ project.title }}" loading="lazy">{% else %}<div class="proj-result-img-placeholder"><i class="fas fa-folder"></i></div>{% endif %}
                        {% if project.featured %}<span class="absolute top-3 right-3 font-mono text-xs px-2 py-1" style="background:var(--gold);color:#fff;">★ Featured</span>{% endif %}
                    </div>
                    <div class="proj-result-body">
                        <div class="meta-line mb-2"><span><i class="fas fa-eye"></i>{{ project.views }}</span><span><i class="fas fa-heart"></i>{{ project.likes }}</span><span><i class="fas fa-calendar"></i>{{ project.project_date|date:"M Y" }}</span></div>
                        <h3 class="font-semibold mb-2 leading-snug" style="color:var(--navy);font-size:1.05rem">{{ project.title }}</h3>
                        <p class="text-sm mb-3 line-clamp-2" style="color:var(--muted)">{{ project.description|truncatewords:20|striptags }}</p>
                        {% if project.technologies %}<div class="flex flex-wrap gap-1 mb-3">{% for tech in project.tech_list|slice:":3" %}<span class="tag-pill">{{ tech }}</span>{% endfor %}</div>{% endif %}
                        <span class="link-arrow">View Project <i class="fas fa-arrow-right text-xs"></i></span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Blog Posts -->
        {% if posts %}
        <div class="result-group mb-16" data-category="posts" data-aos="fade-up" data-aos-delay="100">
            <div class="result-section-header">
                <div class="section-bar" style="background:linear-gradient(to bottom,#7c3aed,#ec4899)"></div>
                <h2 class="section-title">Blog Posts</h2>
                <span class="section-count">{{ posts|length }}</span>
            </div>
            <div class="space-y-4">
                {% for post in posts %}
                <a href="{{ post.get_absolute_url }}" class="post-result result-card flex flex-col md:flex-row">
                    <div class="post-result-img">
                        {% if post.featured_image %}<img src="{{ post.featured_image }}" alt="{{ post.title }}" loading="lazy">{% else %}<div class="proj-result-img-placeholder"><i class="fas fa-newspaper"></i></div>{% endif %}
                    </div>
                    <div class="post-result-body">
                        <div class="meta-line mb-3"><span><i class="fas fa-calendar"></i>{{ post.published_date|date:"M d, Y" }}</span><span><i class="fas fa-eye"></i>{{ post.views }}</span><span><i class="fas fa-clock"></i>{{ post.reading_time|default:5 }} min</span></div>
                        <h3 class="font-display text-xl mb-2 leading-snug" style="color:var(--navy)">{{ post.title }}</h3>
                        <p class="text-sm mb-3 line-clamp-3" style="color:var(--muted)">{{ post.excerpt|default:post.content|truncatewords:30|striptags }}</p>
                        {% if post.tags.all %}<div class="flex flex-wrap gap-1 mb-4">{% for tag in post.tags.all|slice:":4" %}<span class="tag-pill">#{{ tag.name }}</span>{% endfor %}</div>{% endif %}
                        <span class="link-arrow">Read Article <i class="fas fa-arrow-right text-xs"></i></span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Services -->
        {% if services %}
        <div class="result-group mb-16" data-category="services" data-aos="fade-up" data-aos-delay="200">
            <div class="result-section-header">
                <div class="section-bar" style="background:linear-gradient(to bottom,#16a34a,#059669)"></div>
                <h2 class="section-title">Services</h2>
                <span class="section-count">{{ services|length }}</span>
            </div>
            <div class="grid md:grid-cols-2 gap-5">
                {% for service in services %}
                <div class="service-result result-card">
                    <div class="flex items-start gap-4">
                        <div class="service-icon"><i class="{{ service.icon|default:'fas fa-cog' }}"></i></div>
                        <div class="flex-1">
                            <h3 class="font-semibold mb-2" style="color:var(--navy);font-size:1.1rem"><a href="{% url 'service_detail' service.slug %}" style="text-decoration:none;color:inherit">{{ service.title }}</a></h3>
                            <p class="text-sm mb-3 line-clamp-2" style="color:var(--muted)">{{ service.short_description }}</p>
                            {% if service.technologies %}<div class="flex flex-wrap gap-1 mb-4">{% for tech in service.tech_list|slice:":3" %}<span class="tag-pill">{{ tech }}</span>{% endfor %}</div>{% endif %}
                            <div class="flex items-center justify-between pt-3" style="border-top:1px solid var(--cream-dark)">
                                {% if service.starting_price %}<span class="font-semibold" style="color:var(--navy)">From ${{ service.starting_price }}</span>{% else %}<span class="text-sm" style="color:var(--muted)">Custom Quote</span>{% endif %}
                                <a href="{% url 'service_detail' service.slug %}" class="link-arrow">Learn More <i class="fas fa-arrow-right text-xs"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <!-- No results -->
        <div class="text-center py-16" data-aos="fade-up">
            <div class="w-24 h-24 mx-auto mb-6 flex items-center justify-center" style="background:var(--cream-dark)">
                <i class="fas fa-search text-4xl" style="color:var(--muted)"></i>
            </div>
            <h2 class="font-display text-4xl mb-3" style="color:var(--navy)">No Results Found</h2>
            <p class="mb-10" style="color:var(--muted)">Nothing matching <em>"{{ query }}"</em> — try different keywords.</p>
            <div class="tips-box max-w-xl mx-auto mb-12 text-left">
                <p class="font-mono text-xs tracking-widest uppercase mb-4" style="color:var(--gold-muted)">Search Tips</p>
                <ul>
                    <li class="tip-item"><i class="fas fa-circle"></i>Try different or more general keywords</li>
                    <li class="tip-item"><i class="fas fa-circle"></i>Check your spelling</li>
                    <li class="tip-item"><i class="fas fa-circle"></i>Use fewer words in your search</li>
                    <li class="tip-item"><i class="fas fa-circle"></i>Browse by category instead</li>
                </ul>
            </div>
            <div class="grid sm:grid-cols-3 gap-4 max-w-3xl mx-auto">
                <a href="{% url 'projects' %}" class="browse-card"><div class="browse-icon"><i class="fas fa-folder"></i></div><h3 class="font-semibold mb-1" style="color:var(--navy)">Projects</h3><p class="text-sm" style="color:var(--muted)">Browse all projects</p></a>
                <a href="{% url 'blog' %}" class="browse-card"><div class="browse-icon" style="background:#3b1d8c"><i class="fas fa-newspaper" style="color:#a78bfa"></i></div><h3 class="font-semibold mb-1" style="color:var(--navy)">Blog</h3><p class="text-sm" style="color:var(--muted)">Latest articles</p></a>
                <a href="{% url 'services' %}" class="browse-card"><div class="browse-icon" style="background:#14532d"><i class="fas fa-briefcase" style="color:#4ade80"></i></div><h3 class="font-semibold mb-1" style="color:var(--navy)">Services</h3><p class="text-sm" style="color:var(--muted)">What I offer</p></a>
            </div>
        </div>
        {% endif %}
    </div>
</section>

{% else %}
<!-- No query state -->
<section class="py-20 bg-white">
    <div class="container mx-auto px-6 lg:px-8 max-w-5xl">
        <div class="section-label">Browse Categories</div>
        <div class="grid md:grid-cols-3 gap-5" data-aos="fade-up">
            <a href="{% url 'projects' %}" class="browse-card"><div class="browse-icon"><i class="fas fa-folder"></i></div><h3 class="font-display text-xl mb-2" style="color:var(--navy)">Projects</h3><p class="text-sm mb-4" style="color:var(--muted)">Explore my portfolio of completed work</p><span class="link-arrow">Browse Projects <i class="fas fa-arrow-right text-xs"></i></span></a>
            <a href="{% url 'blog' %}" class="browse-card"><div class="browse-icon" style="background:#3b1d8c"><i class="fas fa-newspaper" style="color:#a78bfa"></i></div><h3 class="font-display text-xl mb-2" style="color:var(--navy)">Blog</h3><p class="text-sm mb-4" style="color:var(--muted)">Articles about web development and design</p><span class="link-arrow">Read Articles <i class="fas fa-arrow-right text-xs"></i></span></a>
            <a href="{% url 'services' %}" class="browse-card"><div class="browse-icon" style="background:#14532d"><i class="fas fa-briefcase" style="color:#4ade80"></i></div><h3 class="font-display text-xl mb-2" style="color:var(--navy)">Services</h3><p class="text-sm mb-4" style="color:var(--muted)">Discover what I can do for you</p><span class="link-arrow">View Services <i class="fas fa-arrow-right text-xs"></i></span></a>
        </div>
    </div>
</section>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
AOS.init({duration:900,once:true,offset:80});

// Tab filter
document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',function(){
        const filter=this.dataset.filter;
        document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.result-group').forEach(g=>{
            g.style.display=(filter==='all'||g.dataset.category===filter)?'':'none';
        });
    });
});

// Highlight search terms
const q='{{ query|escapejs }}';
if(q){
    const terms=q.toLowerCase().split(' ').filter(t=>t.length>2);
    document.querySelectorAll('.proj-result h3,.proj-result p,.post-result h3,.post-result p').forEach(el=>{
        let html=el.innerHTML;
        terms.forEach(term=>{
            const rx=new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
            html=html.replace(rx,'<mark class="search-hl">$1</mark>');
        });
        el.innerHTML=html;
    });
}

// Keyboard shortcut
document.addEventListener('keydown',e=>{
    if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();document.querySelector('input[name="q"]')?.focus();}
});
</script>
{% endblock %}