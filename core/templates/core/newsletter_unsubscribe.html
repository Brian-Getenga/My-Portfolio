{% extends 'base.html' %}
{% load static %}

{% block title %}Unsubscribe - {{ site_settings.site_name }}{% endblock %}
{% block meta_description %}Manage your newsletter subscription preferences.{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap');
    :root{--navy:#0a0f2e;--navy-mid:#141b4d;--gold:#c9932a;--gold-light:#e8b84b;--gold-muted:#8a6520;--cream:#f8f4ef;--cream-dark:#ede8e0;--charcoal:#2c2c3e;--muted:#6b6b7f;}
    *{font-family:'DM Sans',sans-serif;}
    .font-display{font-family:'Playfair Display',Georgia,serif;}
    .font-mono{font-family:'DM Mono',monospace;}
    body{background:var(--cream);color:var(--charcoal);}

    .unsub-hero{background:var(--navy);position:relative;overflow:hidden;}
    .unsub-hero::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(201,147,42,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(201,147,42,.04) 1px,transparent 1px);background-size:60px 60px;}
    .blob{position:absolute;border-radius:50%;filter:blur(80px);pointer-events:none;}

    .status-icon{width:96px;height:96px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem;}
    .status-icon.success{background:linear-gradient(135deg,#1a4a2a,#166534);border:1px solid rgba(34,197,94,.25);box-shadow:0 0 40px rgba(34,197,94,.12);}
    .status-icon.error{background:linear-gradient(135deg,#4a1a1a,#7f1d1d);border:1px solid rgba(239,68,68,.25);box-shadow:0 0 40px rgba(239,68,68,.12);}
    .status-icon i{font-size:2.25rem;color:#fff;}

    .main-card{background:#fff;border:1px solid rgba(201,147,42,.15);box-shadow:0 2px 40px rgba(10,15,46,.06);position:relative;}
    .main-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold),var(--gold-light),var(--gold));}

    .stat-pill{background:var(--cream);border:1px solid var(--cream-dark);padding:1rem 1.5rem;text-align:center;}
    .stat-label{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:.4rem;}
    .stat-value{font-family:'Playfair Display',serif;font-size:1.75rem;color:var(--navy);font-weight:700;display:block;}

    .feedback-btn{background:var(--cream);border:1px solid var(--cream-dark);padding:.875rem 1.25rem;font-size:.875rem;font-weight:500;color:var(--charcoal);cursor:pointer;transition:all .25s ease;text-align:left;display:flex;align-items:center;gap:.625rem;width:100%;}
    .feedback-btn:hover{border-color:var(--gold);background:#fff;color:var(--navy);}
    .feedback-btn.selected{background:var(--navy);border-color:var(--navy);color:var(--gold-light);}
    .feedback-btn i{color:var(--gold);font-size:.8rem;}
    .feedback-btn.selected i{color:var(--gold-light);}

    .btn-primary{display:inline-flex;align-items:center;justify-content:center;gap:.625rem;padding:.875rem 2rem;background:var(--navy);color:var(--gold-light);font-size:.75rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;border:1px solid var(--navy);transition:all .25s ease;}
    .btn-primary:hover{background:#1e2a6e;border-color:var(--gold);}
    .btn-secondary{display:inline-flex;align-items:center;justify-content:center;gap:.625rem;padding:.875rem 2rem;background:transparent;color:var(--navy);font-size:.75rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;border:1px solid var(--charcoal);transition:all .25s ease;}
    .btn-secondary:hover{border-color:var(--navy);background:var(--cream);}

    .info-step{background:#fff;border:1px solid var(--cream-dark);padding:2rem;position:relative;}
    .step-num{font-family:'Playfair Display',serif;font-size:3rem;font-weight:700;color:var(--cream-dark);line-height:1;position:absolute;top:1.25rem;right:1.5rem;}
    .step-icon{width:40px;height:40px;background:var(--navy);display:flex;align-items:center;justify-content:center;margin-bottom:1.25rem;}
    .step-icon i{color:var(--gold);font-size:1rem;}

    .connect-card{background:#fff;border:1px solid var(--cream-dark);padding:2rem;}
    .social-btn{width:38px;height:38px;display:flex;align-items:center;justify-content:center;border:1px solid var(--cream-dark);color:var(--charcoal);text-decoration:none;transition:all .2s ease;font-size:.875rem;}
    .social-btn:hover{border-color:var(--gold);color:var(--gold);}

    .dashed-box{border:1px dashed rgba(201,147,42,.35);background:rgba(201,147,42,.03);padding:1.75rem 2rem;}
    .link-gold{color:var(--gold-muted);font-size:.875rem;font-weight:600;text-decoration:none;letter-spacing:.06em;display:inline-flex;align-items:center;gap:.5rem;border-bottom:1px solid transparent;transition:all .2s ease;}
    .link-gold:hover{color:var(--gold);border-bottom-color:var(--gold);}

    .email-link{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;background:var(--cream);border:1px solid var(--cream-dark);color:var(--navy);font-size:.875rem;font-weight:500;text-decoration:none;font-family:'DM Mono',monospace;transition:all .2s ease;}
    .email-link:hover{border-color:var(--gold);background:#fff;}

    .issues-list{list-style:none;padding:0;margin:0;}
    .issues-list li{display:flex;align-items:flex-start;gap:.75rem;padding:.625rem 0;border-bottom:1px solid var(--cream-dark);font-size:.875rem;color:var(--charcoal);}
    .issues-list li:last-child{border-bottom:none;}
    .issues-list li i{color:var(--gold);margin-top:3px;font-size:.7rem;}

    .section-label{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:1rem;margin-bottom:3rem;}
    .section-label::before{content:'';width:3rem;height:1px;background:var(--cream-dark);}
    .section-label::after{content:'';flex:1;height:1px;background:var(--cream-dark);}

    @keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .7s ease forwards;}
    .d1{animation-delay:.1s;opacity:0;}.d2{animation-delay:.2s;opacity:0;}.d3{animation-delay:.3s;opacity:0;}
</style>
{% endblock %}

{% block content %}
<section class="unsub-hero pt-40 pb-24 min-h-[52vh] flex items-center">
    <div class="blob w-96 h-96 bg-blue-900 opacity-20 top-0 left-1/4" style="top:-4rem;left:10%"></div>
    <div class="blob w-64 h-64 bg-amber-800 opacity-15" style="bottom:-2rem;right:15%"></div>
    <div class="container mx-auto px-6 lg:px-8 max-w-3xl text-center relative z-10">
        {% if success %}
        <div class="status-icon success fade-up"><i class="fas fa-check"></i></div>
        <span class="font-mono text-xs tracking-widest text-green-400 uppercase fade-up d1">Confirmed</span>
        <h1 class="font-display text-5xl lg:text-6xl text-white mt-4 mb-4 leading-tight fade-up d2">You've Been<br><em class="text-amber-300">Unsubscribed</em></h1>
        <p class="text-slate-400 text-lg max-w-xl mx-auto leading-relaxed fade-up d3">We're sorry to see you go. You've been removed from our mailing list and won't hear from us again.</p>
        {% else %}
        <div class="status-icon error fade-up"><i class="fas fa-exclamation"></i></div>
        <span class="font-mono text-xs tracking-widest text-red-400 uppercase fade-up d1">Error</span>
        <h1 class="font-display text-5xl lg:text-6xl text-white mt-4 mb-4 leading-tight fade-up d2">Something<br><em class="text-amber-300">Went Wrong</em></h1>
        <p class="text-slate-400 text-lg max-w-xl mx-auto leading-relaxed fade-up d3">We couldn't process your unsubscribe request. The link may be invalid or expired.</p>
        {% endif %}
    </div>
</section>

<section class="py-20" style="background:var(--cream)">
    <div class="container mx-auto px-6 lg:px-8 max-w-2xl">
        {% if success %}
        <div class="main-card p-10 mb-8">
            <div class="grid grid-cols-2 gap-px mb-10" style="background:var(--cream-dark)">
                <div class="stat-pill"><span class="stat-label">Days Subscribed</span><span class="stat-value">{{ days_subscribed|default:"—" }}</span></div>
                <div class="stat-pill"><span class="stat-label">Emails Received</span><span class="stat-value">{{ emails_sent|default:"0" }}</span></div>
            </div>
            <p class="font-mono text-xs tracking-widest uppercase mb-1" style="color:var(--gold-muted)">Optional Feedback</p>
            <h3 class="font-display text-2xl mb-2" style="color:var(--navy)">Why did you leave?</h3>
            <p class="text-sm mb-5" style="color:var(--muted)">Your feedback helps us improve. No response required.</p>
            <div class="grid grid-cols-2 gap-2 mb-10">
                <button class="feedback-btn" data-reason="Too many emails"><i class="fas fa-inbox"></i> Too many emails</button>
                <button class="feedback-btn" data-reason="Not relevant"><i class="fas fa-times-circle"></i> Not relevant</button>
                <button class="feedback-btn" data-reason="Didn't sign up"><i class="fas fa-user-slash"></i> Didn't sign up</button>
                <button class="feedback-btn" data-reason="Other"><i class="fas fa-ellipsis-h"></i> Other reason</button>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 mb-10">
                <a href="{% url 'contact' %}" class="btn-primary flex-1"><i class="fas fa-envelope text-xs"></i> Contact Us</a>
                <a href="{% url 'home' %}" class="btn-secondary flex-1"><i class="fas fa-arrow-left text-xs"></i> Homepage</a>
            </div>
            <div class="dashed-box">
                <p class="text-sm font-semibold mb-1" style="color:var(--navy)">Changed your mind?</p>
                <p class="text-xs mb-3" style="color:var(--muted)">You can resubscribe at any time — we'd love to have you back.</p>
                <a href="{% url 'home' %}#newsletter" class="link-gold"><i class="fas fa-redo text-xs"></i> Resubscribe to Newsletter</a>
            </div>
        </div>
        {% else %}
        <div class="main-card p-10 mb-8">
            <h3 class="font-display text-2xl mb-1" style="color:var(--navy)">Common Issues</h3>
            <p class="text-sm mb-6" style="color:var(--muted)">Here's what may have gone wrong:</p>
            <ul class="issues-list mb-8">
                <li><i class="fas fa-circle"></i>The unsubscribe link has expired</li>
                <li><i class="fas fa-circle"></i>You may have already unsubscribed</li>
                <li><i class="fas fa-circle"></i>The link was truncated in your email client</li>
                <li><i class="fas fa-circle"></i>The token is invalid or malformed</li>
            </ul>
            <div class="flex flex-col sm:flex-row gap-3 mb-10">
                <a href="{% url 'contact' %}" class="btn-primary flex-1"><i class="fas fa-headset text-xs"></i> Contact Support</a>
                <a href="{% url 'home' %}" class="btn-secondary flex-1"><i class="fas fa-arrow-left text-xs"></i> Homepage</a>
            </div>
            <div class="dashed-box">
                <p class="text-sm font-semibold mb-1" style="color:var(--navy)">Need manual removal?</p>
                <p class="text-xs mb-3" style="color:var(--muted)">Email us directly and we'll remove you immediately:</p>
                <a href="mailto:{{ site_settings.email }}" class="email-link"><i class="fas fa-at text-xs" style="color:var(--gold)"></i>{{ site_settings.email }}</a>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<section class="py-20 bg-white">
    <div class="container mx-auto px-6 lg:px-8 max-w-5xl">
        <div class="section-label">Privacy &amp; Data</div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-px mb-16" style="background:var(--cream-dark)" data-aos="fade-up">
            <div class="info-step"><div class="step-num">01</div><div class="step-icon"><i class="fas fa-user-minus"></i></div><h3 class="text-base font-semibold mb-2" style="color:var(--navy)">Immediate Removal</h3><p class="text-sm" style="color:var(--muted)">Your email is removed from our active mailing list the moment you click unsubscribe.</p></div>
            <div class="info-step"><div class="step-num">02</div><div class="step-icon"><i class="fas fa-clock"></i></div><h3 class="text-base font-semibold mb-2" style="color:var(--navy)">24–48 Hours</h3><p class="text-sm" style="color:var(--muted)">Allow up to 48 hours for complete propagation across all our communication systems.</p></div>
            <div class="info-step"><div class="step-num">03</div><div class="step-icon"><i class="fas fa-shield-check"></i></div><h3 class="text-base font-semibold mb-2" style="color:var(--navy)">No Further Action</h3><p class="text-sm" style="color:var(--muted)">Nothing else required. Your data is handled in accordance with our privacy policy.</p></div>
        </div>
        <div class="section-label">Other Ways to Connect</div>
        <div class="grid sm:grid-cols-2 gap-px" style="background:var(--cream-dark)" data-aos="fade-up" data-aos-delay="100">
            <div class="connect-card"><div class="w-10 h-10 flex items-center justify-center mb-4" style="background:var(--cream)"><i class="fas fa-rss" style="color:var(--gold)"></i></div><h4 class="text-base font-semibold mb-2" style="color:var(--navy)">RSS Feed</h4><p class="text-sm mb-4" style="color:var(--muted)">Subscribe via RSS to receive updates on your own schedule, with no inbox clutter.</p><a href="/feed" class="link-gold">Subscribe to RSS →</a></div>
            <div class="connect-card"><div class="w-10 h-10 flex items-center justify-center mb-4" style="background:var(--cream)"><i class="fas fa-share-alt" style="color:var(--gold)"></i></div><h4 class="text-base font-semibold mb-2" style="color:var(--navy)">Social Media</h4><p class="text-sm mb-4" style="color:var(--muted)">Follow along on social media for project updates, writing, and occasional insights.</p><div class="flex gap-2">{% if site_settings.twitter_url %}<a href="{{ site_settings.twitter_url }}" target="_blank" class="social-btn"><i class="fab fa-twitter"></i></a>{% endif %}{% if site_settings.linkedin_url %}<a href="{{ site_settings.linkedin_url }}" target="_blank" class="social-btn"><i class="fab fa-linkedin-in"></i></a>{% endif %}{% if site_settings.github_url %}<a href="{{ site_settings.github_url }}" target="_blank" class="social-btn"><i class="fab fa-github"></i></a>{% endif %}</div></div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.feedback-btn').forEach(btn=>{
    btn.addEventListener('click',async function(){
        document.querySelectorAll('.feedback-btn').forEach(b=>b.classList.remove('selected'));
        this.classList.add('selected');
        const reason=this.dataset.reason;
        this.innerHTML=`<i class="fas fa-check"></i> ${reason} — noted`;
        try{await fetch('{% url "newsletter_feedback" %}',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':'{{ csrf_token }}'},body:JSON.stringify({reason})});}catch(e){}
    });
});
</script>
{% endblock %}